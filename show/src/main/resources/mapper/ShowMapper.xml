<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gqb.show.dao.ShowDao">

    <!--cloum是数据库建表的字段名 ,property是java实体类的属性名-->
    <resultMap id="BaseResultMap" type="com.gqb.show.entity.Show">
        <id column="id" property="id" jdbcType="BIGINT"/>
        <id column="showtype_id" property="showTypeId" jdbcType="BIGINT"/>
        <id column="show_name" property="showName" jdbcType="VARCHAR"/>
        <id column="show_intro" property="showIntro" jdbcType="VARCHAR"/>
        <id column="show_performer" property="showPerformer" jdbcType="VARCHAR"/>
        <id column="show_city" property="showCity" jdbcType="VARCHAR"/>
        <id column="show_place" property="showPlace" jdbcType="VARCHAR"/>
        <id column="show_time" property="showTime" jdbcType="TIMESTAMP"/>
        <id column="end_time" property="endTime" jdbcType="TIMESTAMP"/>
        <id column="show_poster" property="showPoster" jdbcType="VARCHAR"/>
        <id column="show_mobile" property="showMobile" jdbcType="VARCHAR"/>
        <id column="create_time" property="createTime" jdbcType="TIMESTAMP"/>
    </resultMap>


    <select id="getAllShows" resultMap="BaseResultMap">
        select * from show_list
    </select>

    <select id="getShowByTime" resultMap="BaseResultMap">
        select * from show_list where show_time > now();
    </select>

    <select id="getShowByCity" parameterType="String" resultMap="BaseResultMap">
        select * from show_list where show_city like "%"#{showCity}"%";
    </select>

    <select id="getShowByPerformer" parameterType="String" resultMap="BaseResultMap">
        select * from show_list where show_performer like "%"#{showPerformer}"%";
    </select>

    <select id="getShowByType" parameterType="String" resultMap="BaseResultMap">
        select show_list.id,show_type,show_name,show_performer,show_city,show_place,show_time,end_time,show_poster,show_mobile,create_time
        from show_list join showtype where show_list.showtype_id=showtype.id and showtype.show_type like "%"#{showType}"%"
    </select>

    <select id="getShowById" parameterType="Long" resultMap="BaseResultMap">
        select * from show_list where id=#{id};
    </select>

    <select id="getShowByName" parameterType="String" resultMap="BaseResultMap">
        select * from show_list where show_name like "%"#{showName}"%";
    </select>

    <!--useGeneratedKeys和keyProperty获取数据库自动生成的id，只对insert有效-->
    <insert id="createShow" parameterType="com.gqb.show.entity.Show" useGeneratedKeys="true" keyProperty="id">
        insert into show_list(showtype_id,show_name,show_intro,show_performer,show_city,show_place,show_time,end_time,show_poster,show_mobile)
            values(#{showTypeId},#{showName},#{showIntro},#{showPerformer},#{showCity},#{showPlace},#{showTime},#{endTime},#{showPoster},#{showMobile});
    </insert>

    <delete id="deleteShowById" parameterType="Long">
        delete from show_list where id =#{id};
    </delete>

    <delete id="deleteShowByName" parameterType="String">
        delete from show_list where show_name=#{showName};
    </delete>
</mapper>